<!--
  'listComponent' représente un tableau générique réutilisable destiné à afficher des données
  avec des fonctionnalités telles que la recherche, la pagination et des actions sur les éléments.
  Ce composant offre une mise en page flexible avec des en-têtes de colonnes dynamiques,
  la possibilité de rechercher des éléments, et des boutons d'ajout, de  mise à jour et
  de suppression si configurés. Il permet d'afficher des données de manière structurée
  tout en offrant une interface utilisateur interactive.
-->
<!-- Rendu conditionnel du spinner de chargement
    Si la variable `loading` est évaluée à true, le spinner de chargement est affiché
-->
@if(service.loading$ | async) {
<div class="backdrop"></div>
<app-spinner></app-spinner>
}


<!-- Conteneur principal du composant de tableau générique -->
<div class="container mt-3 ms-5 ps-5">
  <div class="panel panel-default">

    <!-- Section en-tête -->
    <nav class="navbar  justify-content-between position-relative">
      <div class="container container-nav">
        <!-- Nom du tableau affiché en tant qu'en-tête -->
        <div class="panel-heading">{{name}}</div>
        @if((service.count$ | async) !==0 ){
        <!-- Input filtre -->
        <mat-form-field class="custom-input position-absolute start-50 translate-middle">
          <input matInput [(ngModel)]="searchTerm" (ngModelChange)="applyFilter()"
                 placeholder="Filtre">
        </mat-form-field>
        }
        <!-- Bouton d'ajout d'élément si autorisé -->
        @if (showPlusButton) {
        <button mat-icon-button (click)="openDialog(true)" class="mx-2">
          <mat-icon class="icon-display" fontIcon="add_circle"></mat-icon>
        </button>
        }
      </div>
    </nav>

    @if((service.count$ | async) !==0 && !service.loading$ ){
    <!-- Section tableau -->
    <div class="panel-body mt-4">
      <!-- Tableau affichant les données avec en-têtes de colonnes -->
      <table class="table table-bordered">
        <thead>
          <tr>
            <!-- En-têtes de colonnes générés dynamiquement -->
            @for (namecolumn of namecolumns; track namecolumn) {
            <th class="text-center">{{ namecolumn }}</th>
            }
            @if (showButtonAction) {
            <!-- Colonne d'actions si autorisée -->
            <th class="col-2 text-center">Action</th>
            }
          </tr>
        </thead>
        <tbody>
          <!-- Lignes de données affichées avec pagination -->
          @for (item of items$ | async  | paginate: { itemsPerPage: 8, currentPage: page }; track item ) {
          <tr>
            @for (column of columns; track column) {
            @if (isStock && item.countdown === 'Expiré'){
            <td class="text-center" [style.background-color]="themeService.getWarnOpacity()">
              {{ formatColumnValue(item, column) }}
            </td>
            }
            @else {
            <td class="text-center">
              {{ formatColumnValue(item, column) }}
            </td>
            }
            }
            <!-- Actions sur les éléments si autorisées -->
            @if (showButtonAction) {
            <td [style.background-color]="isStock && item.countdown === 'Expiré' ? themeService.getWarnOpacity() : themeService.getPrimaryLighter()">
              <div class="d-flex justify-content-around">
                <!-- Bouton de mise à jour -->
                <button mat-mini-fab color="accent" (click)="openDialog(false,item)">
                  <mat-icon fontIcon="edit"></mat-icon>
                </button>
                <!-- Bouton de suppression si le bouton n'est pas désactivé -->
                @if (!isStock) {
                <button mat-mini-fab color="warn" (click)="onDeleteItem(item)" [disabled]="shouldDisableItem(item)">
                  <mat-icon fontIcon="delete_forever"></mat-icon>
                </button>
                }
              </div>
            </td>
            }            
          </tr>
          }
        </tbody>
      </table>
      <!-- Contrôles de pagination -->
      <pagination-controls (pageChange)="page = $event"></pagination-controls>
    </div>
    }
    @else {
    <div class="d-flex justify-content-center align-items-center" style="height: 500px;">
      <mat-card>
        <mat-card-header>
          <mat-card-title class="mt-3" style="font-size:22px;">Aucune donnée</mat-card-title>         
        </mat-card-header>
        <mat-card-content>
          <img mat-card-image src="../../../../assets/image/no-data.png" />
        </mat-card-content>
      </mat-card>
    </div>
    }
  </div>
</div>

